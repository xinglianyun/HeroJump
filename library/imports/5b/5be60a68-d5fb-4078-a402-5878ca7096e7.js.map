{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\enemy/assets\\Script\\enemy\\DartEnemy.js"],"names":["dartNodes","cc","Class","extends","Component","properties","emitDartTime","default","type","Float","_startSide","Integer","_overScreenX","_idle","Boolean","onLoad","_game","find","_totalOffsetY","_targetWorldPos","Vec2","_isEmitDart","node","getComponent","setRealListener","_enemyNodeType","Global","enemyNodeType","dartenemy","start","update","dt","gameMainSceneSpeed","gameMainScene","getRunSpeed","offsetY","y","Math","abs","director","getWinSize","height","emitDartNode","beCollected","addChildDartNode","dartNode","parent","push","setStartSide","startSide","setTargetWorldPos","worldPos","beVictory","stopAllActions","beKilled","i","length","gameManager","collectEnemy","setIdle","idle","moveToHeroPos","convertToNodeSpace","x","moveAction","moveTo","dartNodeWorldPos","convertToWorldSpace","getPosition","tmpPos","setPosition","runAction","moveBy","width"],"mappings":"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","file":"DartEnemy.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\enemy","sourcesContent":["var dartNodes = [];\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // emit the dart when the dart enemy go throw the screen\r\n        emitDartTime : {\r\n            default : 0.3,\r\n            type : cc.Float\r\n        },\r\n        // 开始方向\r\n        _startSide : {\r\n            default : -1, \r\n            type : cc.Integer\r\n        },\r\n        // 飞向hero的飞镖的终点在屏幕外的x坐标\r\n        _overScreenX : {\r\n            default : -100.0,\r\n            type : cc.Float\r\n        },\r\n        _idle : {\r\n            default : false,\r\n            type : cc.Boolean\r\n        },\r\n    },\r\n\r\n\r\n    \r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this._game = cc.find(\"Game\")\r\n        this._totalOffsetY = 0.0\r\n        this._startSide = -1\r\n        this._targetWorldPos = cc.Vec2(0, 0)\r\n        this._isEmitDart = false\r\n        this.node.getComponent(\"Enemy\").setRealListener(this)\r\n        this._enemyNodeType = Global.enemyNodeType.dartenemy\r\n\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        if(this._idle){\r\n            return\r\n        }\r\n\r\n        var gameMainSceneSpeed = Global.gameMainScene.getRunSpeed()\r\n        var offsetY = gameMainSceneSpeed * dt\r\n        this.node.y += offsetY\r\n        this._totalOffsetY += offsetY\r\n\r\n        if(!this._isEmitDart){\r\n            if(Math.abs(this._totalOffsetY) >= cc.director.getWinSize().height * this.emitDartTime){\r\n                // emit the DartNode\r\n                this.emitDartNode()\r\n                this._isEmitDart = true\r\n            }\r\n        }\r\n\r\n        if(Math.abs(this._totalOffsetY) >= cc.director.getWinSize() * 1.5){\r\n            this.beCollected()\r\n        }\r\n    },\r\n\r\n    //************************************start logic*************************************************//\r\n    /**\r\n     * desc: add the dart node to dart\r\n     */\r\n    addChildDartNode : function(dartNode){\r\n        dartNode.parent = this.node\r\n        dartNodes.push(dartNode)\r\n    },\r\n    /**\r\n     * desc: set the start side\r\n     */\r\n    setStartSide : function(startSide){\r\n        this._startSide = startSide\r\n    },\r\n\r\n    /**\r\n     * desc: set the world pos of target\r\n     */\r\n    setTargetWorldPos : function(worldPos){\r\n        this._targetWorldPos = worldPos\r\n    },\r\n\r\n    /**\r\n     * desc: kill the hero\r\n     */\r\n    beVictory : function(){\r\n        this.node.stopAllActions()\r\n    },\r\n\r\n    /**\r\n     * desc: killed by the hero\r\n     */\r\n    beKilled : function(){\r\n        this.node.stopAllActions()\r\n        for(let i = 0; i < dartNodes.length; ++i){\r\n            if(dartNodes[i]){\r\n                dartNodes[i].stopAllActions()\r\n                dartNodes[i].getComponent(\"DartNode\").beCollected()\r\n            }\r\n        }\r\n        dartNodes = []\r\n        Global.gameManager.collectEnemy(this.node, this._enemyNodeType)\r\n    },\r\n    /**\r\n     * desc: node to be collected\r\n     */\r\n    beCollected : function(){\r\n        this.node.stopAllActions()\r\n        for(let i = 0; i < dartNodes.length; ++i){\r\n            if(dartNodes[i]){\r\n                dartNodes[i].stopAllActions()\r\n                dartNodes[i].getComponent(\"DartNode\").beCollected()\r\n            }\r\n        }\r\n        Global.gameManager.collectEnemy(this.node, this._enemyNodeType)\r\n    },\r\n\r\n    /**\r\n     * desc: set the enemy state\r\n     */\r\n    setIdle : function(idle){\r\n        this._idle= idle\r\n    },\r\n\r\n    /**\r\n     * desc: emit the dart node\r\n     */\r\n    emitDartNode : function(){\r\n        for(let i = 0; i < dartNodes.length; ++i){\r\n            if(i === 0){\r\n                // fly to hero\r\n                var moveToHeroPos = this.node.parent.convertToNodeSpace(this._targetWorldPos)\r\n                moveToHeroPos.x += this._startSide*this._overScreenX\r\n                moveToHeroPos.y += (this._overScreenX * Math.abs(this.node.y - moveToHeroPos.y)) / (Math.abs(this.node.x - moveToHeroPos.x))\r\n                var moveAction = cc.moveTo(cc.director.getWinSize().height * (1- this.emitDartTime) / Math.abs(Global.gameMainScene.getRunSpeed()) * 0.5, moveToHeroPos)\r\n                // change the dartnode's parent to the grandpa\r\n                var dartNodeWorldPos = this.node.convertToWorldSpace(dartNodes[i].getPosition())\r\n                var tmpPos = this.node.parent.convertToNodeSpace(dartNodeWorldPos)\r\n                dartNodes[i].parent = this.node.parent\r\n                dartNodes[i].setPosition(tmpPos)\r\n                dartNodes[i].runAction(moveAction)\r\n            }else if(i === 1){\r\n                // fly horizon\r\n                var moveAction = cc.moveBy(cc.director.getWinSize().height * (1- this.emitDartTime) / Math.abs(Global.gameMainScene.getRunSpeed()), this._startSide * cc.director.getWinSize().width, 0)\r\n                dartNodes[i].runAction(moveAction)\r\n            }else if(i === 2){\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    //************************************end logic*************************************************//\r\n\r\n});\r\n"]}