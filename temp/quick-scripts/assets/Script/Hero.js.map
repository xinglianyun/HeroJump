{"version":3,"sources":["Hero.js"],"names":["HeroStatus","cc","Enum","dead","running","jump","fly","Class","extends","Component","properties","colliderProxy","default","type","require","propCenterNode","Node","invincibleTime","Float","onLoad","start","_status","_leftOrRight","setRealListener","_allProps","circleprop","count","circlePropNode","_invincible","_invincibleDurTime","_oldParentNode","update","dt","setInvincible","setLeftOrRight","leftOrRight","getLeftOrRight","run","getComponent","Animation","play","destroy","jumpFromSideToSide","offsetX","Global","gameMainScene","rightHeroPosNode","x","leftHeroPosNode","moveAction","moveBy","callfuncAction","callFunc","node","scaleX","action","sequence","runAction","addProp","propNode","beOnHero","propEnemyType","getPropEnemyType","enemyType","addCircleProp","parent","setPosition","beCollected","deleteCircleProp","beOffHero","setKeepTime","invincible","centerHeroPosNode","enemyNodeType","bird","dartnode","cat","worldPos","convertToWorldSpaceAR","position","nodePos","convertToNodeSpaceAR","getInvincible","onCollisionEnter","other","self","console","log","group","game","groupList","groupIndex","beKilled","beVictory","gameOver","getEnemyNodeType","showDeadEnemyNode"],"mappings":"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","file":"Hero.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// 英雄状态\r\nvar HeroStatus = cc.Enum({\r\n    dead : -1,//死亡，需要collect\r\n    running : -1,//跑\r\n    jump : -1,// 跳\r\n    fly : -1,// 无敌飞行\r\n})\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 碰撞代理组件\r\n        colliderProxy : {\r\n            default : null,\r\n            type : require(\"HeroColliderProxy\")\r\n        },\r\n        // 道具的挂载节点\r\n        propCenterNode : {\r\n            default : null,\r\n            type : cc.Node\r\n        },\r\n        // 无敌时间\r\n        invincibleTime : {\r\n            default : 3.0,\r\n            type : cc.Float\r\n        },\r\n        \r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n    },\r\n\r\n    start () {\r\n        this._status = HeroStatus.running\r\n        this._leftOrRight = -1\r\n        this.colliderProxy.setRealListener(this)\r\n        // hero props\r\n        this._allProps = {\r\n            circleprop : {\r\n                count : 0,\r\n                circlePropNode : null\r\n            }\r\n        }\r\n        // invincible or not\r\n        this._invincible = false\r\n        // invicble time\r\n        this._invincibleDurTime = 0.0\r\n        this._oldParentNode = null\r\n    },\r\n\r\n    update (dt) {\r\n        if(this._invincible){\r\n            this._invincibleDurTime += dt\r\n            if(this._invincibleDurTime >= this.invincibleTime){\r\n                this._invincibleDurTime = 0\r\n                this.setInvincible(false)\r\n            }\r\n        }\r\n    },\r\n\r\n    //************************************start logic*************************************************//\r\n    /**\r\n     * desc: left(-1) or right(1)\r\n     */\r\n    setLeftOrRight : function(leftOrRight){\r\n        this._leftOrRight = leftOrRight\r\n    },\r\n\r\n    /**\r\n     * desc: return left or right\r\n     */\r\n    getLeftOrRight : function(){\r\n        return this._leftOrRight\r\n    },\r\n\r\n    /**\r\n     * desc: run state\r\n     */\r\n    run : function(){\r\n        this._status = HeroStatus.running\r\n        this.getComponent(cc.Animation).play(\"HeroRunClip\")\r\n    },\r\n\r\n    /**\r\n     * desc: fly state\r\n     */\r\n    fly : function(){\r\n        this._status = HeroStatus.fly\r\n    },\r\n\r\n    /**\r\n     * desc: dead state\r\n     */\r\n    dead : function(){\r\n        this._status = HeroStatus.dead\r\n        if(this._allProps.circleprop.circlePropNode){\r\n            this._allProps.circleprop.circlePropNode.destroy()\r\n            this._allProps.circleprop.count = 0\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n     * desc: jump state\r\n     */\r\n    jumpFromSideToSide : function(){\r\n        if(this._status === HeroStatus.running){\r\n            this._status = HeroStatus.jump\r\n\r\n            this._leftOrRight *= -1\r\n\r\n            var offsetX = Global.gameMainScene.rightHeroPosNode.x - Global.gameMainScene.leftHeroPosNode.x\r\n            offsetX *= this._leftOrRight \r\n            this.getComponent(cc.Animation).play(\"HeroJumpClip\")\r\n\r\n            var moveAction = cc.moveBy(0.33, offsetX, 0)\r\n            var callfuncAction = cc.callFunc(\r\n                function(){\r\n                    this.node.scaleX *= (-1)\r\n                    this.run()\r\n                }, this\r\n            )\r\n            var action = cc.sequence(moveAction, callfuncAction)\r\n            this.node.runAction(action)\r\n        }\r\n    },\r\n\r\n    /**\r\n     * desc: add the prop\r\n     */\r\n    addProp : function(propNode){\r\n        propNode.getComponent(\"Prop\").beOnHero()\r\n        var propEnemyType = propNode.getComponent(\"Prop\").getPropEnemyType()\r\n        switch(propEnemyType){\r\n            case Global.enemyType.circleprop:\r\n                this.addCircleProp(propNode)\r\n                break\r\n        }\r\n    },\r\n\r\n    /**\r\n     * desc: add the circle prop\r\n     */\r\n    addCircleProp(propNode){\r\n        this._allProps.circleprop.count += 1\r\n\r\n        if(!this._allProps.circleprop.circlePropNode){\r\n            propNode.parent = this.propCenterNode\r\n            propNode.setPosition(0, 0)\r\n            this._allProps.circleprop.circlePropNode= propNode\r\n        }else{\r\n            propNode.getComponent(\"Prop\").beCollected()\r\n        }\r\n    },\r\n    /**\r\n     * desc: delete one circle prop\r\n     */\r\n    deleteCircleProp : function(){\r\n        this._allProps.circleprop.count -= 1\r\n        if(this._allProps.circleprop.count <= 0){\r\n            this._allProps.circleprop.count = 0\r\n            if(this._allProps.circleprop.circlePropNode){\r\n                this._allProps.circleprop.circlePropNode.getComponent(\"Prop\").beOffHero()\r\n                this._allProps.circleprop.circlePropNode.getComponent(\"Prop\").beCollected()\r\n                this._allProps.circleprop.circlePropNode = null\r\n            }\r\n        }else{\r\n            this._allProps.circleprop.circlePropNode.getComponent(\"CircleProp\").setKeepTime(0.0)\r\n        }\r\n    },\r\n\r\n    /**\r\n     * desc: set the hero invincible\r\n     */\r\n    setInvincible : function(invincible, type){\r\n        this._invincible = invincible\r\n        if(invincible){\r\n            this._oldParentNode = this.node.parent\r\n            this.node.parent = Global.gameMainScene.centerHeroPosNode\r\n            switch(type){\r\n                case Global.enemyNodeType.bird:\r\n                    this.getComponent(cc.Animation).play(\"HeroBirdRushClip\")\r\n                    this.fly()\r\n                    break\r\n                case Global.enemyNodeType.dartnode:\r\n                    this.getComponent(cc.Animation).play(\"HeroDartRushClip\")\r\n                    this.fly()\r\n                    break\r\n                case Global.enemyNodeType.cat:\r\n                    this.getComponent(cc.Animation).play(\"HeroCatRushClip\")\r\n                    this.fly()\r\n                    break\r\n            }\r\n        }else{\r\n            this.node.parent = this._oldParentNode\r\n            this.node.scaleX *= -1\r\n            this.node.setPosition(0, 0)\r\n            if(this._leftOrRight === 1){\r\n                var worldPos = Global.gameMainScene.rightHeroPosNode.parent.convertToWorldSpaceAR(Global.gameMainScene.rightHeroPosNode.position)\r\n                var nodePos = Global.gameMainScene.leftHeroPosNode.convertToNodeSpaceAR(worldPos)\r\n                this.node.setPosition(nodePos)\r\n            }\r\n            this.run()\r\n        }\r\n    },\r\n\r\n    /**\r\n     * desc: get the hero invincible\r\n     */\r\n    getInvincible : function(){\r\n        return this._invincible\r\n    },\r\n\r\n    /**\r\n     * desc: 当碰撞产生的时候调用\r\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n     */\r\n    onCollisionEnter: function (other, self) {\r\n        console.log('on collision enter')\r\n        \r\n        if(this._status !== HeroStatus.dead){\r\n            var group = cc.game.groupList[other.node.groupIndex]\r\n            if(group === \"enemy\"){\r\n                if(this._status === HeroStatus.running && !this._invincible){\r\n                    if(this._allProps.circleprop.count > 0){\r\n                        this.deleteCircleProp()\r\n                        other.node.getComponent(\"Enemy\").beKilled()\r\n                    }else{\r\n                        // dead, game oveer\r\n                        this.dead()\r\n                        other.node.getComponent(\"Enemy\").beVictory()\r\n                        Global.gameMainScene.gameOver()\r\n                    }\r\n                }else{\r\n                    var enemyNodeType = other.node.getComponent(\"Enemy\").getEnemyNodeType()\r\n                    Global.gameMainScene.showDeadEnemyNode(enemyNodeType)\r\n                    other.node.getComponent(\"Enemy\").beKilled()\r\n                }\r\n            }else if(group === \"prop\") {\r\n                this.addProp(other.node)\r\n            }\r\n        }\r\n    },\r\n    //************************************end logic*************************************************//\r\n});\r\n"]}