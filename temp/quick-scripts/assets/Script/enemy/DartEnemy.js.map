{"version":3,"sources":["DartEnemy.js"],"names":["cc","Class","extends","Component","properties","emitDartTime","default","type","Float","_startSide","Integer","_overScreenX","_idle","Boolean","_dartNodes","Node","onLoad","_game","find","node","getComponent","setRealListener","_enemyNodeType","Global","enemyNodeType","dartenemy","console","log","uuid","onInit","start","update","dt","gameMainSceneSpeed","gameMainScene","getRunSpeed","offsetY","y","_totalOffsetY","_isEmitDart","Math","abs","director","getWinSize","height","emitDartNode","beCollected","onDestroy","reuse","_targetWorldPos","Vec2","setPosition","setScale","addChildDartNode","dartNode","parent","push","setStartSide","startSide","setTargetWorldPos","worldPos","beVictory","stopAllActions","beKilled","i","length","gameManager","collectEnemy","setIdle","idle","getEnemyNodeType","DisplayDeadEnemyState","isDeadState","BoxCollider","enabled","moveToHeroPos","convertToNodeSpace","x","moveAction","moveTo","dartNodeWorldPos","convertToWorldSpace","getPosition","tmpPos","runAction","offsetX","width","scaleX","time","moveBy"],"mappings":"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","file":"DartEnemy.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\enemy","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // emit the dart when the dart enemy go throw the screen\r\n        emitDartTime : {\r\n            default : 0.3,\r\n            type : cc.Float\r\n        },\r\n        // 开始方向\r\n        _startSide : {\r\n            default : -1, \r\n            type : cc.Integer\r\n        },\r\n        // 飞向hero的飞镖的终点在屏幕外的x坐标\r\n        _overScreenX : {\r\n            default : -100.0,\r\n            type : cc.Float\r\n        },\r\n        _idle : {\r\n            default : false,\r\n            type : cc.Boolean\r\n        },\r\n        _dartNodes : [cc.Node]\r\n    },\r\n\r\n\r\n    \r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this._game = cc.find(\"Game\")\r\n        \r\n        this.node.getComponent(\"Enemy\").setRealListener(this)\r\n        this._enemyNodeType = Global.enemyNodeType.dartenemy\r\n\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy onLoad \" + this.node.uuid)\r\n        this.onInit()\r\n\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        if(this._idle){\r\n            return\r\n        }\r\n\r\n        var gameMainSceneSpeed = Global.gameMainScene.getRunSpeed()\r\n        var offsetY = gameMainSceneSpeed * dt\r\n        this.node.y += offsetY\r\n        this._totalOffsetY += offsetY\r\n\r\n        if(!this._isEmitDart){\r\n            if(Math.abs(this._totalOffsetY) >= cc.director.getWinSize().height * this.emitDartTime){\r\n                // emit the DartNode\r\n                this.emitDartNode()\r\n                this._isEmitDart = true\r\n            }\r\n        }\r\n\r\n        if(Math.abs(this._totalOffsetY) >= cc.director.getWinSize() * 1.5){\r\n            this.beCollected()\r\n        }\r\n    },\r\n\r\n    onDestroy : function(){\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy onDestroy \" + this.node.uuid)\r\n        this._dartNodes = [];\r\n    },\r\n\r\n    reuse : function(){\r\n        this.onInit()\r\n    },\r\n\r\n    //************************************start logic*************************************************//\r\n    onInit : function(){\r\n        this._totalOffsetY = 0.0\r\n        this._startSide = -1\r\n        this._targetWorldPos = cc.Vec2(0, 0)\r\n        this._isEmitDart = false\r\n        this._idle = false\r\n\r\n        this.node.setPosition(0, 0)\r\n        this.node.setScale(1)\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy onInit \" + this.node.uuid)\r\n\r\n    },\r\n    /**\r\n     * desc: add the dart node to dart\r\n     */\r\n    addChildDartNode : function(dartNode){\r\n        dartNode.parent = this.node\r\n        this._dartNodes.push(dartNode)\r\n\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy addChildDartNode \" + this.node.uuid + \" \" + dartNode.uuid)\r\n        \r\n    },\r\n    /**\r\n     * desc: set the start side\r\n     */\r\n    setStartSide : function(startSide){\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy setStartSide \" + this.node.uuid)\r\n        this._startSide = startSide\r\n    },\r\n\r\n    /**\r\n     * desc: set the world pos of target\r\n     */\r\n    setTargetWorldPos : function(worldPos){\r\n        this._targetWorldPos = worldPos\r\n    },\r\n\r\n    /**\r\n     * desc: kill the hero\r\n     */\r\n    beVictory : function(){\r\n        this.node.stopAllActions()\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy beVictory \" + this.node.uuid)\r\n    },\r\n\r\n    /**\r\n     * desc: killed by the hero\r\n     */\r\n    beKilled : function(){\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy beKilled \" + this.node.uuid)\r\n\r\n        this.node.stopAllActions()\r\n        for(let i = 0; i < this._dartNodes.length; ++i){\r\n            if(this._dartNodes[i]){\r\n                this._dartNodes[i].stopAllActions()\r\n                this._dartNodes[i].getComponent(\"DartNode\").beCollected()\r\n            }\r\n        }\r\n        this._dartNodes = []\r\n        Global.gameManager.collectEnemy(this.node, this._enemyNodeType)\r\n    },\r\n    /**\r\n     * desc: node to be collected\r\n     */\r\n    beCollected : function(){\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy beCollected \" + this.node.uuid)\r\n\r\n        this.node.stopAllActions()\r\n        for(let i = 0; i < this._dartNodes.length; ++i){\r\n            if(this._dartNodes[i]){\r\n                this._dartNodes[i].stopAllActions()\r\n                this._dartNodes[i].getComponent(\"DartNode\").beCollected()\r\n            }\r\n        }\r\n        Global.gameManager.collectEnemy(this.node, this._enemyNodeType)\r\n    },\r\n\r\n    /**\r\n     * desc: set the enemy state\r\n     */\r\n    setIdle : function(idle){\r\n        this._idle= idle\r\n    },\r\n\r\n    /**\r\n     * desc: get enemy node type\r\n     */\r\n    getEnemyNodeType : function(){\r\n        return this._enemyNodeType\r\n    },\r\n\r\n    /**\r\n     * desc: display the dead enemy when killed\r\n     */\r\n    DisplayDeadEnemyState : function(isDeadState){\r\n        this.getComponent(cc.BoxCollider).enabled = !isDeadState\r\n        this.setIdle(isDeadState)\r\n    },\r\n\r\n    /**\r\n     * desc: emit the dart node\r\n     */\r\n    emitDartNode : function(){\r\n        console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy emitDartNode \" + this.node.uuid)\r\n        \r\n        for(let i = 0; i < this._dartNodes.length; ++i){\r\n            if(i === 0){\r\n                console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy emitDartNode emit\" + this._dartNodes[i].uuid)\r\n                // fly to hero\r\n                var moveToHeroPos = this.node.parent.convertToNodeSpace(this._targetWorldPos)\r\n                moveToHeroPos.x += this._startSide*this._overScreenX\r\n                moveToHeroPos.y += (this._overScreenX * Math.abs(this.node.y - moveToHeroPos.y)) / (Math.abs(this.node.x - moveToHeroPos.x))\r\n                var moveAction = cc.moveTo(cc.director.getWinSize().height * (1- this.emitDartTime) / Math.abs(Global.gameMainScene.getRunSpeed()) * 0.5, moveToHeroPos)\r\n                // change the dartnode's parent to the grandpa\r\n                var dartNodeWorldPos = this.node.convertToWorldSpace(this._dartNodes[i].getPosition())\r\n                var tmpPos = this.node.parent.convertToNodeSpace(dartNodeWorldPos)\r\n                this._dartNodes[i].parent = this.node.parent\r\n                this._dartNodes[i].setPosition(tmpPos)\r\n                this._dartNodes[i].runAction(moveAction)\r\n            }else if(i === 1){\r\n                // fly horizon\r\n                var offsetX = -1 * this._startSide * cc.director.getWinSize().width * this.node.scaleX\r\n                var time = cc.director.getWinSize().height * (1- this.emitDartTime) / Math.abs(Global.gameMainScene.getRunSpeed())\r\n                var moveAction = cc.moveBy(time, offsetX, 0)\r\n                console.log(\"aaaaaaaaaaaaaaaaaa DartEnemy emitDartNode emit \" + this._dartNodes[i].uuid + \" _startSide \" + this._startSide + \" time \" + time + \" offsetX \" + offsetX)\r\n\r\n                this._dartNodes[i].runAction(moveAction)\r\n            }else if(i === 2){\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    //************************************end logic*************************************************//\r\n\r\n});\r\n"]}