{"version":3,"sources":["DartEnemy.js"],"names":["dartNodes","cc","Class","extends","Component","properties","emitDartTime","default","type","Float","_startSide","Integer","_overScreenX","addChildDartNode","dartNode","parent","node","push","onLoad","_game","find","_totalOffsetY","_targetWorldPos","Vec2","_isEmitDart","getComponent","setRealListener","_enemyNodeType","Global","enemyNodeType","dartenemy","start","update","dt","gameMainSceneSpeed","gameMainScene","getRunSpeed","offsetY","y","Math","abs","director","getWinSize","height","emitDartNode","gameManager","collectEnemy","setStartSide","startSide","setTargetWorldPos","worldPos","beVictory","stopAllActions","beKilled","i","moveToHeroPos","convertToNodeSpace","x","moveAction","moveTo","callfunc","callFunc","target","sequence","dartNodeWorldPos","convertToWorldSpace","getPosition","tmpPos","setPosition","runAction","moveBy","width","length"],"mappings":"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","file":"DartEnemy.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\enemy","sourcesContent":["var dartNodes = [];\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // emit the dart when the dart enemy go throw the screen\r\n        emitDartTime : {\r\n            default : 0.3,\r\n            type : cc.Float\r\n        },\r\n        _startSide : {\r\n            default : -1, \r\n            type : cc.Integer\r\n        },\r\n        _overScreenX : {\r\n            default : -100.0,\r\n            type : cc.Float\r\n        },\r\n    },\r\n\r\n\r\n    //logic\r\n    addChildDartNode : function(dartNode){\r\n        dartNode.parent = this.node\r\n        dartNodes.push(dartNode)\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this._game = cc.find(\"Game\")\r\n        this._totalOffsetY = 0.0\r\n        this._startSide = -1\r\n        this._targetWorldPos = cc.Vec2(0, 0)\r\n        this._isEmitDart = false\r\n        this.node.getComponent(\"Enemy\").setRealListener(this)\r\n        this._enemyNodeType = Global.enemyNodeType.dartenemy\r\n\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        var gameMainSceneSpeed = Global.gameMainScene.getRunSpeed()\r\n        var offsetY = gameMainSceneSpeed * dt\r\n        this.node.y += offsetY\r\n        this._totalOffsetY += offsetY\r\n\r\n        if(!this._isEmitDart){\r\n            if(Math.abs(this._totalOffsetY) >= cc.director.getWinSize().height * this.emitDartTime){\r\n                // emit the DartNode\r\n                this.emitDartNode()\r\n                this._isEmitDart = true\r\n            }\r\n        }\r\n\r\n        if(Math.abs(this._totalOffsetY) >= cc.director.getWinSize() * 1.5){\r\n            Global.gameManager.collectEnemy(this.node, this._enemyNodeType)\r\n        }\r\n        \r\n    },\r\n\r\n    // logic\r\n    setStartSide : function(startSide){\r\n        this._startSide = startSide\r\n    },\r\n\r\n    setTargetWorldPos : function(worldPos){\r\n        this._targetWorldPos = worldPos\r\n    },\r\n\r\n    beVictory : function(){\r\n        this.node.stopAllActions()\r\n    },\r\n\r\n    beKilled : function(){\r\n        this.node.stopAllActions()\r\n        Global.gameManager.collectEnemy(this.node, this._enemyNodeType)\r\n    },\r\n\r\n    emitDartNode : function(){\r\n        \r\n        for(let i = 0; i < dartNodes.length; ++i){\r\n            //dartNodes[i].getComponent(\"DartNode\").runToTarget(this._targetWorldPos, i, dartNodes.length)\r\n            if(i === 0){\r\n                var moveToHeroPos = this.node.parent.convertToNodeSpace(this._targetWorldPos)\r\n                moveToHeroPos.x += this._startSide*this._overScreenX\r\n                moveToHeroPos.y += (this._overScreenX * Math.abs(this.node.y - moveToHeroPos.y)) / (Math.abs(this.node.x - moveToHeroPos.x))\r\n                var moveAction = cc.moveTo(cc.director.getWinSize().height * (1- this.emitDartTime) / Math.abs(Global.gameMainScene.getRunSpeed()) * 0.5, moveToHeroPos)\r\n                var callfunc = cc.callFunc(function(target){\r\n                    Global.gameManager.collectEnemy(dartNodes[i], \"dartnode\")\r\n                }, this)\r\n                var sequence = cc.sequence(moveAction, callfunc)\r\n                // change the dartnode's parent to the grandpa\r\n                var dartNodeWorldPos = this.node.convertToWorldSpace(dartNodes[i].getPosition())\r\n                var tmpPos = this.node.parent.convertToNodeSpace(dartNodeWorldPos)\r\n                dartNodes[i].parent = this.node.parent\r\n                dartNodes[i].setPosition(tmpPos)\r\n                dartNodes[i].runAction(sequence)\r\n            }else if(i === 1){\r\n                var moveAction = cc.moveBy(cc.director.getWinSize().height * (1- this.emitDartTime) / Math.abs(Global.gameMainScene.getRunSpeed()), this._startSide * cc.director.getWinSize().width, 0)\r\n\r\n                var callfunc = cc.callFunc(function(target){\r\n                    Global.gameManager.collectEnemy(dartNodes[i], \"dartnode\")\r\n                }, this)\r\n                var sequence = cc.sequence(moveAction, callfunc)\r\n                dartNodes[i].runAction(sequence)\r\n            }else if(i === 2){\r\n\r\n            }\r\n        }\r\n    }\r\n});\r\n"]}